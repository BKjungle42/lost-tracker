{% extends "master.html" %}

{% block head %}
<style>
    BODY{
        max-width: 360px;
        margin: auto;
        margin-top: 3em;
    }
</style>
<meta http-equiv="refresh" content="300" />
{% endblock %}

{% block content %}

<h1>{{station.name}}</h1>
<h2><a href="{{url_for('index')}}">Zeréck op d'Haaptsäit</a></h2>

{% for row in group_states %}
<div class="group state_{{row[1]}} {{row[0].cancelled and 'cancelled' or ''}}" onclick="advanceState({{row[0].id}});">
    {% set icon_file = 'icons/%s.png' % row[1] %}
    <img id="icon_{{station.id}}_{{row[0].id}}" src="{{url_for('static', filename=icon_file)}}" />
    {{row[0].name}}<br />
</div>
{% endfor %}

<script type="text/javascript">
  function advanceState(groupId){
    $.getJSON('/advance/' + groupId + '/' + {{station.id}},
      function(data){
        if (data.new_state === undefined){
          return;
        }
        var elem = document.getElementById(
          'icon_' + data.station_id + '_' + data.group_id);

        if (elem){
          elem.src = '{{url_for('static', filename='icons')}}/' +
              data.new_state + '.png';
        }
      });
    }
</script>
{% endblock %}
